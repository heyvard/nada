<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">Airflow | NADA</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.knada.io/process-data/onprem/airflow"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Airflow | NADA"><meta data-react-helmet="true" name="description" content="Apache Airflow is a tool for orchestration, scheduling"><meta data-react-helmet="true" property="og:description" content="Apache Airflow is a tool for orchestration, scheduling"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.knada.io/process-data/onprem/airflow"><link data-react-helmet="true" rel="alternate" href="https://docs.knada.io/process-data/onprem/airflow" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.knada.io/process-data/onprem/airflow" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.3db205b2.css">
<link rel="preload" href="/assets/js/runtime~main.0f2bb2e1.js" as="script">
<link rel="preload" href="/assets/js/main.77ed1e3d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/nada.svg" alt="NADA logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/nada-darkmode.svg" alt="NADA logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link navbar__link--active" href="/">docs</a><a class="navbar__item navbar__link" href="/adr">adr</a><a class="navbar__item navbar__link" href="/concepts">concepts</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/navikt/nada" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/">NADA</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Find data</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Process data</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">dataverk</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">gcp</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">onprem</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/process-data/onprem/getting-started">Getting started</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/process-data/onprem/airflow">Airflow</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/process-data/onprem/jupyterhub">Jupyterhub</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Read data</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/process-data/onprem/vault">Vault</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Share data</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Share insight</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Airflow</h1></header><p><a href="https://airflow.apache.org/docs/apache-airflow/stable/index.html" target="_blank" rel="noopener noreferrer">Apache Airflow</a> is a tool for orchestration, scheduling
and monitoring of datapipelines. The web UI that comes with Airflow gives the user e.g. easy access to logs for the different
steps in pipelines, the option to trigger datapipelines manually, and statistics on previous runs.</p><p>A datapipeline in Airflow, or DAG (Directed Acyclic Graph), is a set of tasks (or steps) one wishes to execute and describes
the order and dependencies between these tasks. The DAGs are described programmatically in python files and put in a
Github repository which is synchronized with the Airflow instance periodically. Below is a graphical representation of the flow
in one such DAG.</p><p><img alt="Pipeline flow in an Airflow DAG" src="/assets/images/dag-eksempel-ffe2b3c0ef8bdc07bda16dfc3db6d28e.png"></p><p>KNADA offers teams or individuals the option to set up airflow instances in their personal k8s namespaces in the KNADA cluster.</p><p>For more information on Airflow, see <a href="https://airflow.apache.org/docs/apache-airflow/stable/index.html" target="_blank" rel="noopener noreferrer">Airflow docs</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="configuration"></a>Configuration<a class="hash-link" href="#configuration" title="Direct link to heading">#</a></h2><p>In order to set up Airflow one must create a pull request to <a href="https://github.com/navikt/knada-airflow" target="_blank" rel="noopener noreferrer">navikt/knada-airflow</a>
with a .yaml file with the following content in the catalog <em>configs</em>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">namespace: </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">namespace</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">ingress: </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">ingress</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">users:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  - </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Userident </span><span class="token operator file-descriptor important" style="color:#393A34">1</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  - </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Userident </span><span class="token operator file-descriptor important" style="color:#393A34">2</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  - </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">dagsRepo: </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">dagsRepo</span><span class="token operator" style="color:#393A34">&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>With every new pull request to <a href="https://github.com/navikt/knada-airflow" target="_blank" rel="noopener noreferrer">navikt/knada-airflow</a> (including changes to
existing ones) validation checks are performed on the files committed. When these checks passes the committer can
merge his or her own pull request themselves, <em>one does not have to wait for approval from the codeowners</em>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="namespace"></a>namespace<a class="hash-link" href="#namespace" title="Direct link to heading">#</a></h3><p>The name of the k8s namespace where the Airflow instance should be set up (usually the same as your Jupyterhub
namespace).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="ingress"></a>ingress<a class="hash-link" href="#ingress" title="Direct link to heading">#</a></h3><p>The value set in the <em>ingress</em> field becomes the prefix for the address to the Airflow web UI,
i.e. <a href="https://_prefix_-airflow.knada.adeo.no." target="_blank" rel="noopener noreferrer">https://_prefix_-airflow.knada.adeo.no.</a> The users themselves decide what this prefix should be, but usually
the prefix has been set to the same value as the name of the k8s namespace.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="users"></a>users<a class="hash-link" href="#users" title="Direct link to heading">#</a></h3><p>List of the users (NAV idents) which should have access to the Airflow web UI.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="dagsrepo"></a>dagsRepo<a class="hash-link" href="#dagsrepo" title="Direct link to heading">#</a></h3><p>Repository in the navikt organization on Github that contains Python files with DAGs for the Airflow instance.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>The repository must exist</h5></div><div class="admonition-content"><p>The repository does not need to contain any DAG files when the Airflow instance is set up, but the repository <strong>must exist</strong>
on Github prior to setting up the Airflow instance.</p></div></div><p>Once every minute the DAGs in this repository will be synchronized with the Airflow instance.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="dagsrepobranch"></a>dagsRepoBranch<a class="hash-link" href="#dagsrepobranch" title="Direct link to heading">#</a></h3><p>Specifies the branch in the Gihub repository which the Airflow instance should pull.</p><p><strong>default:</strong> main</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="reposynctime"></a>repoSyncTime<a class="hash-link" href="#reposynctime" title="Direct link to heading">#</a></h3><p>Specifies how often (in seconds) the Airflow instance should pull your Github repository.</p><p><strong>default:</strong> 60</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="dvapiendpoint"></a>dvApiEndpoint<a class="hash-link" href="#dvapiendpoint" title="Direct link to heading">#</a></h3><p>When publishing data packages <a href="/process-data/dataverk/README">dataverk</a> uses this parameter to set the api address the data catalog
uses to fetch the content for the data package viewer.</p><p><strong>NAV internal (default):</strong> <a href="https://data.intern.nav.no/api" target="_blank" rel="noopener noreferrer">https://data.intern.nav.no/api</a> (<a href="/find-data/data-catalog#internal-datacatalog-nav-only">internal data catalog</a>)</p><p><strong>External:</strong> <a href="https://data.nav.no/api" target="_blank" rel="noopener noreferrer">https://data.nav.no/api</a> (<a href="/find-data/data-catalog#public-datacatalog">external data catalog</a>)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="dvbucketendpoint"></a>dvBucketEndpoint<a class="hash-link" href="#dvbucketendpoint" title="Direct link to heading">#</a></h3><p>When publishing data packages <a href="/process-data/dataverk/README">dataverk</a> uses this parameter to determine which data catalog the
data package content (resource files and visualizations) should be published to.</p><p><strong>NAV internal (default):</strong> <a href="https://dv-api-intern.prod-gcp.nais.io/storage" target="_blank" rel="noopener noreferrer">https://dv-api-intern.prod-gcp.nais.io/storage</a> (<a href="/find-data/data-catalog#internal-datacatalog-nav-only">internal data catalog</a>)</p><p><strong>External:</strong> <a href="https://dv-api-ekstern.prod-gcp.nais.io/storage" target="_blank" rel="noopener noreferrer">https://dv-api-ekstern.prod-gcp.nais.io/storage</a> (<a href="/find-data/data-catalog#public-datacatalog">external data catalog</a>)</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>external data catalog</h5></div><div class="admonition-content"><p>When not specifying <code>dvApiEndpoint</code> and <code>dvBucketEndpoint</code> the data packages are by default published to the<br>
<a href="/find-data/data-catalog#internal-datakatalog-nav-only">internal data catalog</a>. Do not override these parameters unless you
want to publish data packages to the <a href="/find-data/data-catalog#public-datacatalog">external data catalog</a>.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="examples-of-dag-repositories"></a>Examples of DAG repositories<a class="hash-link" href="#examples-of-dag-repositories" title="Direct link to heading">#</a></h2><ul><li><a href="https://github.com/navikt/nada-dags" target="_blank" rel="noopener noreferrer">nada-dags</a> contains examples on how to use different operators in Airflow.</li><li><a href="https://github.com/navikt/opendata-dags" target="_blank" rel="noopener noreferrer">opendata-dags</a> contains the DAGs used for creating data packages.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="dataverk-airflow"></a>Dataverk-Airflow<a class="hash-link" href="#dataverk-airflow" title="Direct link to heading">#</a></h2><p><a href="https://github.com/navikt/dataverk-airflow" target="_blank" rel="noopener noreferrer">Dataverk-Airflow</a> is a library aimed at making it easier to use
<a href="https://airflow.apache.org/docs/apache-airflow/stable/kubernetes.html" target="_blank" rel="noopener noreferrer">KubernetesPodOperator</a> in the KNADA cluster.</p><p>The library contains wrapper functions for running Jupyter notebooks, Python scripts, BigQuery commands and DBT
transformations in separate k8s pods in the cluster. View
<a href="https://github.com/navikt/dataverk-airflow/blob/master/README.md" target="_blank" rel="noopener noreferrer">README</a> in the repository for examples.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/navikt/nada/edit/master/docs/process-data/onprem/airflow.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/process-data/onprem/getting-started"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Getting started</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/process-data/onprem/jupyterhub"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Jupyterhub Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#configuration" class="table-of-contents__link">Configuration</a><ul><li><a href="#namespace" class="table-of-contents__link">namespace</a></li><li><a href="#ingress" class="table-of-contents__link">ingress</a></li><li><a href="#users" class="table-of-contents__link">users</a></li><li><a href="#dagsrepo" class="table-of-contents__link">dagsRepo</a></li><li><a href="#dagsrepobranch" class="table-of-contents__link">dagsRepoBranch</a></li><li><a href="#reposynctime" class="table-of-contents__link">repoSyncTime</a></li><li><a href="#dvapiendpoint" class="table-of-contents__link">dvApiEndpoint</a></li><li><a href="#dvbucketendpoint" class="table-of-contents__link">dvBucketEndpoint</a></li></ul></li><li><a href="#examples-of-dag-repositories" class="table-of-contents__link">Examples of DAG repositories</a></li><li><a href="#dataverk-airflow" class="table-of-contents__link">Dataverk-Airflow</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/assets/js/runtime~main.0f2bb2e1.js"></script>
<script src="/assets/js/main.77ed1e3d.js"></script>
</body>
</html>
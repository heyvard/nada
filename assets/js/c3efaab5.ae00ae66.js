"use strict";(self.webpackChunknada=self.webpackChunknada||[]).push([[873],{3905:function(e,t,a){a.d(t,{Zo:function(){return u},kt:function(){return m}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var o=n.createContext({}),p=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(o.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=p(a),m=r,f=d["".concat(o,".").concat(m)]||d[m]||c[m]||i;return a?n.createElement(f,s(s({ref:t},u),{},{components:a})):n.createElement(f,s({ref:t},u))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,s=new Array(i);s[0]=d;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l.mdxType="string"==typeof e?e:r,s[1]=l;for(var p=2;p<i;p++)s[p]=a[p];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},2735:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return l},contentTitle:function(){return o},metadata:function(){return p},toc:function(){return u},default:function(){return d}});var n=a(7462),r=a(3366),i=(a(7294),a(3905)),s=["components"],l={title:"Settings file"},o=void 0,p={unversionedId:"process-data/dataverk/settings/README",id:"process-data/dataverk/settings/README",isDocsHomePage:!1,title:"Settings file",description:"Dataverk requires a settings.json file where you specify configurable settings which vary from user",source:"@site/docs/process-data/dataverk/settings/README.md",sourceDirName:"process-data/dataverk/settings",slug:"/process-data/dataverk/settings/README",permalink:"/nada/process-data/dataverk/settings/README",editUrl:"https://github.com/navikt/nada/edit/master/docs/process-data/dataverk/settings/README.md",tags:[],version:"current",frontMatter:{title:"Settings file"},sidebar:"docs",previous:{title:"Publish data packages from GCP projects",permalink:"/nada/process-data/dataverk/publish-from-gcp"},next:{title:"Postgres",permalink:"/nada/process-data/dataverk/settings/postgres"}},u=[{value:"Examples",id:"examples",children:[{value:"With vault",id:"with-vault",children:[]},{value:"Without vault",id:"without-vault",children:[]}]},{value:"Full example",id:"full-example",children:[]},{value:"Reference settings file in code",id:"reference-settings-file-in-code",children:[{value:"Read from databases",id:"read-from-databases",children:[]}]},{value:"Field definitions",id:"field-definitions",children:[]}],c={toc:u};function d(e){var t=e.components,a=(0,r.Z)(e,s);return(0,i.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Dataverk requires a settings.json file where you specify configurable settings which vary from user\nto user. In this file you can specify the sources you wish to read data from, and the storage sink and\nelastic search index you wish to publish data packages to."),(0,i.kt)("h2",{id:"examples"},"Examples"),(0,i.kt)("h3",{id:"with-vault"},"With vault"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'{\n  "db_connection_strings": {\n    "oracle_database": "${ORACLE_CONNECTION_STRING}",\n    "postgres_database": "${POSTGRES_CONNECTION_STRING}"\n  }\n}\n')),(0,i.kt)("p",null,"The above example requires that you are working ",(0,i.kt)("strong",{parentName:"p"},"from a jupyter notebook server on NAIS with ",(0,i.kt)("a",{parentName:"strong",href:"/nada/process-data/onprem/vault"},"vault"),"\nintegration set up for the namespace"),"."),(0,i.kt)("p",null,"To use the settings file above the following secrets must be stored in vault as key/value pairs:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'ORACLE_CONNECTION_STRING: "oracle://user:pass@host:port/db"\nPOSTGRES_CONNECTION_STRING: "postgres://user:pass@host:port/db"\n')),(0,i.kt)("p",null,'When dataverk parses the settings.json file the secret values will be fetched and replace the placeholder values in the\nsettings.json file. E.g. ${ELASTIC_HOST} will be replaced with "',(0,i.kt)("a",{parentName:"p",href:"https://min-elastic-search-host.no%22"},'https://min-elastic-search-host.no"')," in the settings object\ndataverk loads and uses."),(0,i.kt)("h3",{id:"without-vault"},"Without vault"),(0,i.kt)("p",null,"If you are using dataverk outside of Jupyterhub without vault integration the secrets must be written to the settings.json\nfile directly:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'{\n  "db_connection_strings": {\n    "oracle_database": "oracle://user:pass@host:port/db",\n    "postgres_database": "postgres://user:pass@host:port/db"\n  }\n}\n')),(0,i.kt)("h2",{id:"full-example"},"Full example"),(0,i.kt)("p",null,"Below is a full example of a settings.json with all possible configurations."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'{\n  "db_connection_strings": {\n    "oracle_database": "${ORACLE_CONNECTION_STRING}",\n    "postgres_database": "${POSTGRES_CONNECTION_STRING}"\n  },\n  \n  "kafka": {\n    "brokers": ["${KAFKA_BROKER1}",\n                "${KAFKA_BROKER2}",\n                "${KAFKA_BROKER3}"],\n    "group_id": "my_group",\n    "security_protocol": "SASL_SSL",\n    "sasl_mechanism": "PLAIN",\n    "sasl_plain_username": "${SASL_USERNAME}",\n    "sasl_plain_password": "${SASL_PASSWORD}",\n    "schema_registry": "${SCHEMA_REGISTRY_ADDRESS}",\n    "ssl_cafile": "${CA_FILE_PATH}"\n  }\n}\n')),(0,i.kt)("h2",{id:"reference-settings-file-in-code"},"Reference settings file in code"),(0,i.kt)("h3",{id:"read-from-databases"},"Read from databases"),(0,i.kt)("p",null,"In code you reference the database connections in the settings object as follows."),(0,i.kt)("p",null,"settings.json:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'{\n  "db_connection_strings": {\n    "oracle_database": "${ORACLE_CONNECTION_STRING}"\n  }\n}\n')),(0,i.kt)("p",null,"Code:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'from dataverk import Client\ndv = Client()\n\ndf = dv.read_sql("oracle_database", "SELECT * FROM some.table")\n')),(0,i.kt)("h4",{id:"postgres"},"Postgres"),(0,i.kt)("p",null,"See ",(0,i.kt)("a",{parentName:"p",href:"/nada/process-data/dataverk/settings/postgres"},"postgres connections")," to learn how to configure postgres connections for Jupyterhub/Airflow."),(0,i.kt)("h2",{id:"field-definitions"},"Field definitions"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"index_connections"),":",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"datatype: dict"),(0,i.kt)("li",{parentName:"ul"},"definition: Configuration for the elastic search index"),(0,i.kt)("li",{parentName:"ul"},"fields:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"elastic_host:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"datatype: string"),(0,i.kt)("li",{parentName:"ul"},"definition: Elastic search host address "))),(0,i.kt)("li",{parentName:"ul"},"index:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"datatype: string"),(0,i.kt)("li",{parentName:"ul"},"definition: Elastic search index name"))))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"db_connection_strings"),":",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"datatype: dict"),(0,i.kt)("li",{parentName:"ul"},"definition: Connection strings for databases"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"kafka"),":",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"datatype: Dict"),(0,i.kt)("li",{parentName:"ul"},"definition: "),(0,i.kt)("li",{parentName:"ul"},"felter:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"brokers",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"datatype: list"),(0,i.kt)("li",{parentName:"ul"},"definition: List of kafka brokers"))),(0,i.kt)("li",{parentName:"ul"},"group_id",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"datatype: string"),(0,i.kt)("li",{parentName:"ul"},"definition: Kafka consumer group id"))),(0,i.kt)("li",{parentName:"ul"},"security_protocol:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"datatype: string"),(0,i.kt)("li",{parentName:"ul"},"definition: Security protocol used"))),(0,i.kt)("li",{parentName:"ul"},"sasl_mechanism:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"datatype: string"),(0,i.kt)("li",{parentName:"ul"},"definition: Authentication mechanism for kafka"))),(0,i.kt)("li",{parentName:"ul"},"sasl_plain_username: ",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"datatype: string"),(0,i.kt)("li",{parentName:"ul"},"definition: Username for authentication"))),(0,i.kt)("li",{parentName:"ul"},"sasl_plain_password:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"datatype: string"),(0,i.kt)("li",{parentName:"ul"},"definition: Password for authentication"))),(0,i.kt)("li",{parentName:"ul"},"schema_registry:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"datatype: string"),(0,i.kt)("li",{parentName:"ul"},"definition: Schema registry address"))),(0,i.kt)("li",{parentName:"ul"},"ssl_cafile:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"datatype: string"),(0,i.kt)("li",{parentName:"ul"},"definition: Path to ca-bundle in container environment")))))))))}d.isMDXComponent=!0}}]);